function _typeof(a){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(a){return typeof a}}else{_typeof=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a}}return _typeof(a)}define ("qtype_kekule_chem_base/render",["kekule"],function(){function a(){function a(){for(var a=[],b=document.getElementsByTagName("span"),c=0,d=b.length,e;c<d;++c){e=b[c].className;if(e&&0<=e.indexOf("K-Chem-Question-Blank")){a.push(b[c])}}return a}function b(a){for(var b=0,d=a.length;b<d;++b){var e=a[b],f=e.getAttribute("data-widget-class"),g=e.getAttribute("data-preferWidget"),h=e.getAttribute("data-name"),j=e.getAttribute("data-input-type");c(e,h,f,g,j)}}function c(a,b,c,f,g){var i=Kekule.ChemWidget.ComponentWidgetNames,j,k;if("composer"===f){j=Kekule.Editor.Composer;k={resizable:!0};if("doc"===g){k.predefinedSetting="fullFunc"}else{k.predefinedSetting="molOnly"}}else{j=Kekule.ChemWidget.Viewer;k={autoSize:!0,enableEditFromVoid:!0};if("doc"===g){k.restrainEditorWithCurrObj=!1;k.editorProperties={predefinedSetting:"molOnly",allowCreateNewChild:!0}}else{k.restrainEditorWithCurrObj=!0;k.editorProperties={predefinedSetting:"molOnly",allowCreateNewChild:!1}}k.editorProperties.minDimension={width:450,height:350}}var l=p(b).answer,m=!l,n=null;if(l){r(l);var o=l.value;if(o){n=q(o)}if(!n||!n.molData)m=!0}var s=new j(a);s.addClassName(c);s.__answerElem__=l;if(k)s.setPropValues(k);if(!m){var t=n.molData,u=n.molDataType||Kekule.IO.MimeType.KEKULE_JSON;try{var v=Kekule.IO.loadMimeData(t,u);if(v)s.setChemObj(v)}catch(a){console.error(a)}}if(j===Kekule.ChemWidget.Viewer){s.setToolButtons([{widgetClass:Kekule.Widget.DropDownButton,htmlClass:"KM-Btn-Copy-Structure",text:Kekule.$L("KekuleMoodleTexts.CAPTION_COPY_QUESTION_STRUCTURE"),hint:Kekule.$L("KekuleMoodleTexts.HINT_COPY_QUESTION_STRUCTURE"),dropDownWidgetGetter:e,"#dropDown":h},Kekule.ChemWidget.ComponentWidgetNames.openEditor])}if(j===Kekule.ChemWidget.Viewer){s.on("load",d)}return s}function d(a){var b=a.currentTarget||a.target;if(b instanceof Kekule.ChemWidget.Viewer){var c=b.__answerElem__;if(c){var d="",e="",f="",g="",h=b.getChemObj();if(h){try{e=Kekule.IO.saveMimeData(h,Kekule.IO.MimeType.KEKULE_JSON);f=Kekule.IO.saveMimeData(h,Kekule.IO.MimeType.SMILES,{ignoreStereo:!1});g=Kekule.IO.saveMimeData(h,Kekule.IO.MimeType.SMILES,{ignoreStereo:!0})}catch(a){}var i={smiles:f||"",smilesNoStereo:g||"",molData:e||""};d=JSON.stringify(i)}c.value=d}}}function e(a){var b=a.getDocument(),c=new KekuleMoodle.Widget.ChemObjSelectorPanel(b);c._questionElem=j(a.getParent().getParent().getElement());c.setCaption(Kekule.$L("KekuleMoodleTexts.CAPTION_COPY_QUESTION_STRUCTURE"));c.on("select",f);g(a,c);return c}function f(a){var b=a.target,c=a.chemObj;if(c&&c instanceof Kekule.StructureFragment){var d=b._invokerViewer;d.setChemObj(c.clone())}}function g(a,b){var c=[],d=a.getParent().getParent(),e=d.getElement(),f=j(e),g=k(f);if(g){Kekule.ArrayUtils.remove(g,d);c=c.concat(o(g))}for(var h=m(f)||[],p=0,q=h.length;p<q;++p){var l=h[p],r=l.getAttribute("data-chem-obj");if(r){{var s=JSON.parse(r),t=Class.ObjSerializerFactory.getSerializer("json"),u=t.load(null,s);if(u){c=c.concat(n(u))}}{}}}b.setObjects(c)}function h(a){var b=a.target,c=b.getDropDownWidget();c._invokerViewer=b.getParent().getParent();var d=j(b.getParent().getParent().getElement());if(d!==c._questionElem){c._questionElem=d;g(b,c)}}function i(a){return 0<=(a.className||"").indexOf("que ")}function j(a){if(i(a))return a;else if(a===a.ownerDocument.body)return a;else return j(a.parentNode)}function k(a){for(var b=[],c=Kekule.Widget.Utils.getWidgetsInsideElem(a),d=0,e=c.length;d<e;++d){if(c[d]instanceof Kekule.ChemWidget.Viewer)b.push(c[d])}return b}function m(a){for(var b=[],c=a.getElementsByTagName("img"),d=0,e=c.length,f;d<e;++d){f=c[d];if("Kekule.ChemWidget.Viewer"===(f.getAttribute("data-kekule-widget")||f.getAttribute("data-widget"))){b.push(f)}}return b}function n(a){var b=[],c=Kekule.StructureFragment,d=function(a){return a&&a instanceof c&&a.hasCtab&&a.hasCtab()};if(a instanceof c)b.push(a);else if(a instanceof Kekule.ChemSpace){var e=a.filterChildren(d,!0);b=b.concat(e)}return b}function o(a){for(var b=[],c=0,d=a.length;c<d;++c){var e=a[c],f=e.getChemObj();if(f){b=b.concat(n(f))}}return b}function p(a){return{answer:document.getElementsByName(a)[0]}}function q(a){try{var b=JSON.parse(a);if("object"!==_typeof(b))return{};else return b}catch(a){return{}}}function r(a){a.style.display="none"}Kekule.X.domReady(function(){if(Kekule.Editor.ChemSpaceEditorConfigs&&Kekule.Editor.ChemSpaceEditorConfigs.getInstance){var c=Kekule.Editor.ChemSpaceEditorConfigs.getInstance();c.getInteractionConfigs().setAllowUnknownAtomSymbol(!1)}var d=a();b(d)})}return{init:function init(){Kekule._ready(a)}}});
//# sourceMappingURL=render.min.js.map
