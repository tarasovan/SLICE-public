{"version":3,"sources":["../src/extraWidgets.js"],"names":["define","init","KekuleMoodle","Widget","ChemObjSelectorPanel","Class","create","Kekule","Panel","CLASS_NAME","initialize","parentOrElementOrDocument","renderType","viewerConfigs","tryApplySuper","_renderConfigs","_generateDefaultRenderConfigs","viewerGrid","ChemWidget","ViewerGrid","setEnableAdd","setEnableRemove","setPropStoreFieldValue","on","reactCellClick","bind","initProperties","defineProp","DataType","ARRAY","value","objectsChanged","OBJECT","doFinalize","getViewerGrid","finalize","doGetWidgetClassName","result","Render","Render2DConfigs","getLengthConfigs","setAutofitContextPadding","objs","getObjects","grid","clearWidgets","i","l","length","addChemObj","viewers","getChildWidgets","beginUpdate","setAutoShrink","setRenderConfigs","setPadding","getAutofitContextPadding","endUpdate","_getTargetViewer","srcWidget","Viewer","getParent","parent","e","viewer","target","invokeEvent","getChemObj","_ready"],"mappings":"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","sourcesContent":["define(/*'qtype_kekule_chem_base/extraWidgets',*/ ['kekule', 'local_kekulejs/kekuleMoodle'], function(){\r\n\r\nfunction init() {\r\n\r\n\tif (typeof (KekuleMoodle) === 'undefined')\r\n\t\tKekuleMoodle = {};\r\n\tif (!KekuleMoodle.Widget)\r\n\t\tKekuleMoodle.Widget = {};\r\n\r\n\tKekuleMoodle.Widget.ChemObjSelectorPanel = Class.create(Kekule.Widget.Panel, {\r\n\t\tCLASS_NAME: 'KekuleMoodle.Widget.ChemObjSelectorPanel',\r\n\t\tinitialize: function (/*$super, */parentOrElementOrDocument, renderType, viewerConfigs) {\r\n\t\t\t//this.setPropStoreFieldValue('renderType', renderType);\r\n\t\t\t//this.setPropStoreFieldValue('viewerConfigs', viewerConfigs);\r\n\t\t\tthis.tryApplySuper('initialize', [parentOrElementOrDocument]);\r\n\t\t\tthis._renderConfigs = this._generateDefaultRenderConfigs();\r\n\t\t\tvar viewerGrid = new Kekule.ChemWidget.ViewerGrid(this, renderType, viewerConfigs);\r\n\t\t\tviewerGrid.setEnableAdd(false).setEnableRemove(false);\r\n\t\t\tthis.setPropStoreFieldValue('viewerGrid', viewerGrid);\r\n\t\t\tthis.on('click', this.reactCellClick.bind(this));\r\n\t\t},\r\n\t\tinitProperties: function () {\r\n\t\t\tthis.defineProp('objects', {\r\n\t\t\t\t'dataType': DataType.ARRAY, 'serializable': false,\r\n\t\t\t\t'setter': function (value) {\r\n\t\t\t\t\tthis.setPropStoreFieldValue('objects', value || []);\r\n\t\t\t\t\tthis.objectsChanged();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t//this.defineProp('renderType', {'dataType': DataType.INT, 'serializable': false, 'setter': null});\r\n\t\t\t//this.defineProp('viewerConfigs', {'dataType': DataType.OBJECT, 'serializable': false, 'setter': null});\r\n\r\n\t\t\t// private\r\n\t\t\tthis.defineProp('viewerGrid', {'dataType': DataType.OBJECT, 'serializable': false, 'setter': null});\r\n\t\t},\r\n\t\tdoFinalize: function () {\r\n\t\t\tthis.getViewerGrid().finalize();\r\n\t\t\tthis.tryApplySuper('doFinalize');\r\n\t\t},\r\n\r\n\t\t/** @ignore */\r\n\t\tdoGetWidgetClassName: function (/*$super*/) {\r\n\t\t\treturn this.tryApplySuper('doGetWidgetClassName') + ' ' + 'KM-ChemObjSelectorPanel';\r\n\t\t},\r\n\r\n\t\t_generateDefaultRenderConfigs: function () {\r\n\t\t\tvar result = new Kekule.Render.Render2DConfigs();\r\n\t\t\tresult.getLengthConfigs().setAutofitContextPadding(10);\r\n\t\t\t//result.getLengthConfigs().setBondLineWidth(4);\r\n\t\t\treturn result;\r\n\t\t},\r\n\r\n\t\tobjectsChanged: function ()  // update viewers to reflect to objects change\r\n\t\t{\r\n\t\t\tvar objs = this.getObjects();\r\n\t\t\tvar grid = this.getViewerGrid();\r\n\t\t\tgrid.clearWidgets();\r\n\t\t\tfor (var i = 0, l = objs.length; i < l; ++i) {\r\n\t\t\t\tgrid.addChemObj(objs[i]);\r\n\t\t\t}\r\n\t\t\tvar viewers = grid.getChildWidgets();\r\n\t\t\tfor (var i = 0, l = viewers.length; i < l; ++i) {\r\n\t\t\t\tviewers[i].beginUpdate();\r\n\t\t\t\tviewers[i].setAutoShrink(true);\r\n\t\t\t\tviewers[i].setRenderConfigs(this._renderConfigs);\r\n\t\t\t\tviewers[i].setPadding(this._renderConfigs.getLengthConfigs().getAutofitContextPadding());\r\n\t\t\t\tviewers[i].endUpdate();\r\n\t\t\t\t//viewers[i].repaint();\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_getTargetViewer: function (srcWidget) {\r\n\t\t\tif (srcWidget instanceof Kekule.ChemWidget.Viewer && srcWidget.getParent() === this.getViewerGrid()) {\r\n\t\t\t\treturn srcWidget;\r\n\t\t\t} else {\r\n\t\t\t\tvar parent = srcWidget.getParent();\r\n\t\t\t\treturn parent ? this._getTargetViewer(parent) : null;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\treactCellClick: function (e) {\r\n\t\t\tvar viewer = this._getTargetViewer(e.target);\r\n\t\t\tif (viewer)  // click on viewer\r\n\t\t\t{\r\n\t\t\t\tthis.invokeEvent('select', {'viewer': viewer, 'chemObj': viewer.getChemObj()});\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n}\r\n\r\nreturn {\r\n\t'init': function(){\r\n\t\tKekule._ready(init);\r\n\t}\r\n};\r\n\r\n});"],"file":"extraWidgets.min.js"}