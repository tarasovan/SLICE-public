{"version":3,"sources":["../src/render.js"],"names":["define","init","findPlaceHolders","result","elems","document","getElementsByTagName","i","l","length","className","indexOf","push","createChemWidgets","placeHolderElems","placeHolder","getAttribute","widgetType","ctrlName","inputType","createChemWidget","ansCtrlName","N","Kekule","ChemWidget","ComponentWidgetNames","widgetClass","widgetProps","Editor","Composer","resizable","predefinedSetting","Viewer","autoSize","enableEditFromVoid","restrainEditorWithCurrObj","editorProperties","minDimension","height","ctrlElem","getBlankRelatedElems","answer","isEmpty","jsonObj","hideElem","ansValue","value","parseAnswerString","molData","addClassName","__answerElem__","setPropValues","dataType","molDataType","IO","MimeType","KEKULE_JSON","chemObj","loadMimeData","setChemObj","e","console","error","setToolButtons","Widget","DropDownButton","$L","_btnStructureCopyDropDownPanelGetter","_reactBtnCopyStructureDropdown","openEditor","on","reactViewerChemObjLoad","viewer","currentTarget","target","ansElem","sAnswer","smiles","smilesNoStereo","getChemObj","saveMimeData","SMILES","saveObj","JSON","stringify","btn","doc","getDocument","KekuleMoodle","ChemObjSelectorPanel","_questionElem","getQuestionRootElem","getParent","getElement","setCaption","_reactStructureCopyDropDownPanelSelect","_refreshMoleculesInDropdownPanel","panel","mol","StructureFragment","_invokerViewer","clone","molecules","viewerBlank","viewerBlankElem","questionRootElem","viewersInQuestion","getViewerWidgetsInsideElem","ArrayUtils","remove","concat","getExistedMoleculesInViewers","proxyElems","getViewerProxiesInsideElem","proxy","data","json","parse","serializer","Class","ObjSerializerFactory","getSerializer","load","getMoleculesInChemObj","setObjects","getDropDownWidget","questionElem","isQuestionRootElem","elem","childElem","ownerDocument","body","parentNode","widgets","Utils","getWidgetsInsideElem","imgs","img","obj","objClass","filter","child","hasCtab","ChemSpace","objs","filterChildren","viewers","getElementsByName","style","display","X","domReady","ChemSpaceEditorConfigs","getInstance","editorConfigs","getInteractionConfigs","setAllowUnknownAtomSymbol","placeHolders","_ready"],"mappings":"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","sourcesContent":["define(/*'qtype_kekule_chem_base/render',*/ ['kekule'], function(){\r\n\r\nfunction init() {\r\n\r\n\tfunction findPlaceHolders() {\r\n\t\tvar result = [];\r\n\t\tvar elems = document.getElementsByTagName('span');\r\n\t\tfor (var i = 0, l = elems.length; i < l; ++i) {\r\n\t\t\tvar className = elems[i].className;\r\n\t\t\tif (className && className.indexOf('K-Chem-Question-Blank') >= 0)  // is a place holder\r\n\t\t\t{\r\n\t\t\t\tresult.push(elems[i]);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tfunction createChemWidgets(placeHolderElems) {\r\n\t\tfor (var i = 0, l = placeHolderElems.length; i < l; ++i) {\r\n\t\t\tvar placeHolder = placeHolderElems[i];\r\n\t\t\t//var molData = placeHolder.value;\r\n\t\t\tvar className = placeHolder.getAttribute('data-widget-class');\r\n\t\t\tvar widgetType = placeHolder.getAttribute('data-preferWidget');\r\n\t\t\tvar ctrlName = placeHolder.getAttribute('data-name');\r\n\t\t\tvar inputType = placeHolder.getAttribute('data-input-type');\r\n\t\t\tcreateChemWidget(placeHolder, ctrlName, className, widgetType, inputType);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction createChemWidget(placeHolder, ansCtrlName, className, widgetType, inputType) {\r\n\t\tvar N = Kekule.ChemWidget.ComponentWidgetNames;\r\n\t\tvar widgetClass, widgetProps;\r\n\t\tif (widgetType === 'composer') {\r\n\t\t\twidgetClass = Kekule.Editor.Composer;\r\n\t\t\twidgetProps = {\r\n\t\t\t\tresizable: true\r\n\t\t\t};\r\n\r\n\t\t\tif (inputType === 'doc')  // allow input document\r\n\t\t\t{\r\n\t\t\t\twidgetProps.predefinedSetting = 'fullFunc';\r\n\t\t\t} else  // molecule\r\n\t\t\t{\r\n\t\t\t\twidgetProps.predefinedSetting = 'molOnly';\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\twidgetClass = Kekule.ChemWidget.Viewer;\r\n\t\t\twidgetProps = {\r\n\t\t\t\t//predefinedSetting: 'editOnly',\r\n\t\t\t\t//resizable: true,\r\n\t\t\t\tautoSize: true,\r\n\t\t\t\tenableEditFromVoid: true\r\n\t\t\t};\r\n\r\n\t\t\tif (inputType === 'doc')  // allow input document\r\n\t\t\t{\r\n\t\t\t\twidgetProps.restrainEditorWithCurrObj = false;\r\n\t\t\t\twidgetProps.editorProperties = {\r\n\t\t\t\t\t'predefinedSetting': 'molOnly',\r\n\t\t\t\t\t'allowCreateNewChild': true\r\n\t\t\t\t};\r\n\t\t\t} else  // molecule\r\n\t\t\t{\r\n\t\t\t\twidgetProps.restrainEditorWithCurrObj = true;\r\n\t\t\t\twidgetProps.editorProperties = {\r\n\t\t\t\t\t'predefinedSetting': 'molOnly',\r\n\t\t\t\t\t'allowCreateNewChild': false\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\twidgetProps.editorProperties.minDimension = {'width': 450, height: 350};\r\n\t\t\t/*\r\n\t\t\twidgetProps.editorProperties.commonToolButtons = [\r\n\t\t\t\tN.newDoc,\r\n\t\t\t\tN.loadData,\r\n\t\t\t\tN.saveData,\r\n\t\t\t\tN.undo,\r\n\t\t\t\tN.redo,\r\n\t\t\t\tN.zoomIn,\r\n\t\t\t\tN.zoomOut\r\n\t\t\t];\r\n\t\t\t*/\r\n\t\t}\r\n\r\n\t\tvar ctrlElem = getBlankRelatedElems(ansCtrlName).answer;\r\n\r\n\t\tvar isEmpty = !ctrlElem;\r\n\t\tvar jsonObj = null;\r\n\t\tif (ctrlElem) {\r\n\t\t\t// hide ctrlElem\r\n\t\t\thideElem(ctrlElem);\r\n\t\t\t// get answer value from ctrlElem\r\n\t\t\tvar ansValue = ctrlElem.value;\r\n\t\t\tif (ansValue) {\r\n\t\t\t\t//console.log(ansValue);\r\n\t\t\t\tjsonObj = parseAnswerString(ansValue);\r\n\t\t\t\t/*\r\n\t\t\t\tif (jsonObj && jsonObj.molData)\r\n\t\t\t\t{\r\n\t\t\t\t\tplaceHolder.setAttribute('data-chem-obj', jsonObj.molData);\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t\tisEmpty = true;\r\n\t\t\t\t*/\r\n\t\t\t}\r\n\t\t\tif (!jsonObj || !jsonObj.molData)\r\n\t\t\t\tisEmpty = true;\r\n\t\t}\r\n\r\n\t\tvar result = new widgetClass(placeHolder);\r\n\t\tresult.addClassName(className);\r\n\t\tresult.__answerElem__ = ctrlElem;\r\n\t\tif (widgetProps)\r\n\t\t\tresult.setPropValues(widgetProps);\r\n\r\n\t\tif (!isEmpty)  // load chem object\r\n\t\t{\r\n\t\t\tvar molData = jsonObj.molData;\r\n\t\t\tvar dataType = jsonObj.molDataType || Kekule.IO.MimeType.KEKULE_JSON;\r\n\t\t\ttry {\r\n\t\t\t\tvar chemObj = Kekule.IO.loadMimeData(molData, dataType);\r\n\t\t\t\tif (chemObj)\r\n\t\t\t\t\tresult.setChemObj(chemObj);\r\n\t\t\t} catch (e) {\r\n\t\t\t\tconsole.error(e);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (widgetClass === Kekule.ChemWidget.Viewer) {\r\n\t\t\t// add copy structure button\r\n\t\t\tresult.setToolButtons([{\r\n\t\t\t\t'widgetClass': Kekule.Widget.DropDownButton,\r\n\t\t\t\t'htmlClass': 'KM-Btn-Copy-Structure',\r\n\t\t\t\t'text': Kekule.$L('KekuleMoodleTexts.CAPTION_COPY_QUESTION_STRUCTURE'),\r\n\t\t\t\t'hint': Kekule.$L('KekuleMoodleTexts.HINT_COPY_QUESTION_STRUCTURE'),\r\n\t\t\t\t'dropDownWidgetGetter': _btnStructureCopyDropDownPanelGetter,\r\n\t\t\t\t'#dropDown': _reactBtnCopyStructureDropdown\r\n\t\t\t},\r\n\t\t\t\tKekule.ChemWidget.ComponentWidgetNames.openEditor]);\r\n\t\t}\r\n\r\n\t\t// TODO: now only handle viewer event\r\n\t\tif (widgetClass === Kekule.ChemWidget.Viewer) {\r\n\t\t\tresult.on('load', reactViewerChemObjLoad);\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tfunction reactViewerChemObjLoad(e) {\r\n\t\tvar viewer = e.currentTarget || e.target;\r\n\t\tif (viewer instanceof Kekule.ChemWidget.Viewer)  // avoid event invoked by composer\r\n\t\t{\r\n\t\t\tvar ansElem = viewer.__answerElem__;\r\n\t\t\tif (ansElem) {\r\n\t\t\t\tvar sAnswer = '';\r\n\t\t\t\tvar molData = '', smiles = '', smilesNoStereo = '';\r\n\t\t\t\tvar chemObj = viewer.getChemObj();\r\n\t\t\t\tif (chemObj) {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tmolData = Kekule.IO.saveMimeData(chemObj, Kekule.IO.MimeType.KEKULE_JSON);\r\n\t\t\t\t\t\tsmiles = Kekule.IO.saveMimeData(chemObj, Kekule.IO.MimeType.SMILES, {'ignoreStereo': false});\r\n\t\t\t\t\t\tsmilesNoStereo = Kekule.IO.saveMimeData(chemObj, Kekule.IO.MimeType.SMILES, {'ignoreStereo': true});\r\n\t\t\t\t\t} catch (e) {\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar saveObj = {\r\n\t\t\t\t\t\t'smiles': smiles || '',\r\n\t\t\t\t\t\t'smilesNoStereo': smilesNoStereo || '',\r\n\t\t\t\t\t\t'molData': molData || ''\r\n\t\t\t\t\t};\r\n\t\t\t\t\tsAnswer = JSON.stringify(saveObj);\r\n\t\t\t\t}\r\n\t\t\t\tansElem.value = sAnswer;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction _btnStructureCopyDropDownPanelGetter(btn) {\r\n\t\tvar doc = btn.getDocument();\r\n\t\t/*\r\n\t\tvar result = new Kekule.Widget.Panel(doc);\r\n\t\tvar grid = new Kekule.ChemWidget.ViewerGrid2D(result);\r\n\t\tresult._grid = grid;\r\n\t\tresult._parentViewer = btn.getParent().getParent(); // mark\r\n\t\t*/\r\n\t\tvar result = new KekuleMoodle.Widget.ChemObjSelectorPanel(doc);\r\n\t\tresult._questionElem = getQuestionRootElem(btn.getParent().getParent().getElement());\r\n\t\tresult.setCaption(Kekule.$L('KekuleMoodleTexts.CAPTION_COPY_QUESTION_STRUCTURE'));\r\n\t\tresult.on('select', _reactStructureCopyDropDownPanelSelect);\r\n\t\t_refreshMoleculesInDropdownPanel(btn, result);\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tfunction _reactStructureCopyDropDownPanelSelect(e) {\r\n\t\tvar panel = e.target;\r\n\t\t//console.log(panel._invokerViewer, e.chemObj);\r\n\t\tvar mol = e.chemObj;\r\n\t\tif (mol && mol instanceof Kekule.StructureFragment) {\r\n\t\t\tvar viewer = panel._invokerViewer;\r\n\t\t\tviewer.setChemObj(mol.clone());\r\n\t\t}\r\n\t}\r\n\r\n\tfunction _refreshMoleculesInDropdownPanel(btn, panel) {\r\n\t\t//var grid = panel._grid;\r\n\t\tvar molecules = [];\r\n\t\tvar viewerBlank = btn.getParent().getParent();\r\n\t\t//var viewerBlank = panel._parentViewer;\r\n\t\tvar viewerBlankElem = viewerBlank.getElement();\r\n\t\tvar questionRootElem = getQuestionRootElem(viewerBlankElem);\r\n\t\tvar viewersInQuestion = getViewerWidgetsInsideElem(questionRootElem);\r\n\t\tif (viewersInQuestion) {\r\n\t\t\tKekule.ArrayUtils.remove(viewersInQuestion, viewerBlank);  // filter out viewers in question content\r\n\t\t\tmolecules = molecules.concat(getExistedMoleculesInViewers(viewersInQuestion));\r\n\t\t}\r\n\t\t// some <img> elements may has not been created into viewer\r\n\t\tvar proxyElems = getViewerProxiesInsideElem(questionRootElem) || [];\r\n\t\tfor (var i = 0, l = proxyElems.length; i < l; ++i) {\r\n\t\t\tvar proxy = proxyElems[i];\r\n\t\t\tvar data = proxy.getAttribute('data-chem-obj');\r\n\t\t\tif (data) {\r\n\t\t\t\t//try\r\n\t\t\t\t{\r\n\t\t\t\t\tvar json = JSON.parse(data);\r\n\t\t\t\t\tvar serializer = Class.ObjSerializerFactory.getSerializer('json');\r\n\t\t\t\t\tvar chemObj = serializer.load(null, json)\r\n\t\t\t\t\tif (chemObj) {\r\n\t\t\t\t\t\tmolecules = molecules.concat(getMoleculesInChemObj(chemObj));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t//catch(e)\r\n\t\t\t\t{\r\n\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//console.log(molecules);\r\n\t\t/*\r\n\t\tgrid.clearWidgets();\r\n\t\tfor (var i = 0, l = molecules.length; i < l; ++i)\r\n\t\t{\r\n\t\t\tgrid.addChemObj(molecules[i]);\r\n\t\t}\r\n\t\t*/\r\n\t\tpanel.setObjects(molecules);\r\n\t}\r\n\r\n\tfunction _reactBtnCopyStructureDropdown(e) {\r\n\t\t//console.log('execute');\r\n\t\tvar btn = e.target;\r\n\t\tvar panel = btn.getDropDownWidget();\r\n\t\tpanel._invokerViewer = btn.getParent().getParent();\r\n\t\t//var parentViewer = btn.getParent().getParent();\r\n\t\tvar questionElem = getQuestionRootElem(btn.getParent().getParent().getElement());\r\n\t\tif (questionElem !== panel._questionElem) {\r\n\t\t\t//console.log('refresh');\r\n\t\t\tpanel._questionElem = questionElem;\r\n\t\t\t_refreshMoleculesInDropdownPanel(btn, panel);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction isQuestionRootElem(elem) {\r\n\t\treturn (elem.className || '').indexOf('que ') >= 0;\r\n\t}\r\n\r\n\tfunction getQuestionRootElem(childElem)  // returns the root of a question section\r\n\t{\r\n\t\tif (isQuestionRootElem(childElem))\r\n\t\t\treturn childElem;\r\n\t\telse if (childElem === childElem.ownerDocument.body)\r\n\t\t\treturn childElem;\r\n\t\telse\r\n\t\t\treturn getQuestionRootElem(childElem.parentNode);\r\n\t}\r\n\r\n\tfunction getViewerWidgetsInsideElem(elem)  // returns all viewer widgets under one element\r\n\t{\r\n\t\tvar result = [];\r\n\t\tvar widgets = Kekule.Widget.Utils.getWidgetsInsideElem(elem);\r\n\t\tfor (var i = 0, l = widgets.length; i < l; ++i) {\r\n\t\t\tif (widgets[i] instanceof Kekule.ChemWidget.Viewer)\r\n\t\t\t\tresult.push(widgets[i]);\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tfunction getViewerProxiesInsideElem(elem)  // return <img> elements that has not been created into viewer\r\n\t{\r\n\t\tvar result = [];\r\n\t\tvar imgs = elem.getElementsByTagName('img');\r\n\t\tfor (var i = 0, l = imgs.length; i < l; ++i) {\r\n\t\t\tvar img = imgs[i];\r\n\t\t\tif ((img.getAttribute('data-kekule-widget') || img.getAttribute('data-widget')) === 'Kekule.ChemWidget.Viewer') {\r\n\t\t\t\tresult.push(img);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tfunction getMoleculesInChemObj(obj) {\r\n\t\tvar result = [];\r\n\t\tvar objClass = Kekule.StructureFragment;\r\n\t\tvar filter = function (child) {\r\n\t\t\treturn child && (child instanceof objClass) && (child.hasCtab && child.hasCtab());\r\n\t\t};\r\n\r\n\t\tif (obj instanceof objClass)\r\n\t\t\tresult.push(obj);\r\n\t\telse if (obj instanceof Kekule.ChemSpace) {\r\n\t\t\tvar objs = obj.filterChildren(filter, true);\r\n\t\t\tresult = result.concat(objs);\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tfunction getExistedMoleculesInViewers(viewers) {\r\n\t\tvar result = [];\r\n\t\tfor (var i = 0, l = viewers.length; i < l; ++i) {\r\n\t\t\tvar viewer = viewers[i];\r\n\t\t\tvar obj = viewer.getChemObj();\r\n\t\t\tif (obj) {\r\n\t\t\t\tresult = result.concat(getMoleculesInChemObj(obj));\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tfunction getBlankRelatedElems(ctrlName) {\r\n\t\t// get response form control\r\n\t\treturn {\r\n\t\t\t'answer': document.getElementsByName(ctrlName)[0]\r\n\t\t};\r\n\t}\r\n\r\n\tfunction parseAnswerString(answer) {\r\n\t\ttry {\r\n\t\t\tvar jsonObj = JSON.parse(answer);\r\n\t\t\tif (typeof (jsonObj) !== 'object')\r\n\t\t\t\treturn {};\r\n\t\t\telse\r\n\t\t\t\treturn jsonObj;\r\n\t\t} catch (e) {\r\n\t\t\treturn {};\r\n\t\t}\r\n\t}\r\n\r\n\tfunction hideElem(elem) {\r\n\t\telem.style.display = 'none';\r\n\t}\r\n\r\n\tfunction init() {\r\n\t\t// avoid student to input unwanted pseudo atoms\r\n\t\tif (Kekule.Editor.ChemSpaceEditorConfigs && Kekule.Editor.ChemSpaceEditorConfigs.getInstance) {\r\n\t\t\tvar editorConfigs = Kekule.Editor.ChemSpaceEditorConfigs.getInstance();\r\n\t\t\teditorConfigs.getInteractionConfigs().setAllowUnknownAtomSymbol(false);\r\n\t\t}\r\n\t\t//console.log('question init');\r\n\t\tvar placeHolders = findPlaceHolders();\r\n\t\tcreateChemWidgets(placeHolders);\r\n\t}\r\n\r\n\t//console.log('prepare question init');\r\n\tKekule.X.domReady(init);\r\n\r\n}\r\n\r\nreturn {\r\n\t'init': function(){\r\n\t\t//console.log('render.js initial');\r\n\t\tKekule._ready(init);\r\n\t}\r\n};\r\n\r\n});"],"file":"render.min.js"}