{"version":3,"sources":["../src/kekuleChemViewerInterceptor.js"],"names":["define","init","Kekule","KekuleQuizReportInterceptor","matchPage","document","url","location","pathname","toLowerCase","result","match","getTargetElements","body","querySelectorAll","handleElement","element","children","DomUtils","getChildNodesOfTypes","Node","TEXT_NODE","length","ELEMENT_NODE","content","nodeValue","trim","indexOf","lastIndexOf","jsonObj","JSON","parse","molData","chemObj","IO","loadFormatData","DataFormat","KEKULE_JSON","clearChildContent","viewer","ChemWidget","Viewer2D","ownerDocument","setPredefinedSetting","appendToElem","load","e","execute","doc","targetElems","i","X","domReady","_ready"],"mappings":"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","sourcesContent":["define(/*'local_kekulejs/kekuleChemViewerInterceptor',*/ ['kekule'], function(){\r\n\r\n\tfunction init()\r\n\t{\r\n\t\tif (typeof Kekule === 'undefined')\r\n\t\t\treturn;\r\n\r\n\t\t// utils class to intercept quiz report page\r\n\t\tvar KekuleQuizReportInterceptor = {\r\n\t\t\tmatchPage: function(document)\r\n\t\t\t{\r\n\t\t\t\tvar url = document.location.pathname.toLowerCase();\r\n\t\t\t\tvar result = url.match(/quiz\\/report.php/);\r\n\t\t\t\treturn !!result;\r\n\t\t\t},\r\n\t\t\tgetTargetElements: function(document)\r\n\t\t\t{\r\n\t\t\t\treturn document.body.querySelectorAll('td[id^=\"mod-quiz-report-statistics-question-table\"]');\r\n\t\t\t},\r\n\t\t\thandleElement: function(element)\r\n\t\t\t{\r\n\t\t\t\tvar children = Kekule.DomUtils.getChildNodesOfTypes(element, Node.TEXT_NODE);\r\n\t\t\t\tif (children.length === 1 && !Kekule.DomUtils.getChildNodesOfTypes(element, Node.ELEMENT_NODE).length)  // only with one text node, may be the target\r\n\t\t\t\t{\r\n\t\t\t\t\tvar content = (children[0].nodeValue || '').trim();\r\n\t\t\t\t\tif (content.indexOf('{') === 0 && content.lastIndexOf('}') === content.length - 1)  // wrapped with {}, possible a JSON string\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttry\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tvar jsonObj = JSON.parse(content);\r\n\t\t\t\t\t\t\tif (jsonObj && jsonObj.molData)  // has mol data field\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tvar chemObj = Kekule.IO.loadFormatData(jsonObj.molData, Kekule.IO.DataFormat.KEKULE_JSON);\r\n\t\t\t\t\t\t\t\tif (chemObj)  // chem object load successful, create viewer widget\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tKekule.DomUtils.clearChildContent(element);\r\n\t\t\t\t\t\t\t\t\tvar viewer = new Kekule.ChemWidget.Viewer2D(element.ownerDocument);\r\n\t\t\t\t\t\t\t\t\tviewer.setPredefinedSetting('basic');\r\n\t\t\t\t\t\t\t\t\tviewer.appendToElem(element);\r\n\t\t\t\t\t\t\t\t\tviewer.load(chemObj);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tcatch(e)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t//console.error(e);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\texecute: function(doc)\r\n\t\t\t{\r\n\t\t\t\tif (!doc)\r\n\t\t\t\t\tdoc = document;\r\n\t\t\t\tif (KekuleQuizReportInterceptor.matchPage(doc))\r\n\t\t\t\t{\r\n\t\t\t\t\tvar targetElems = KekuleQuizReportInterceptor.getTargetElements(doc);\r\n\t\t\t\t\tif (targetElems)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tfor (var i = targetElems.length - 1; i >= 0; --i)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tKekuleQuizReportInterceptor.handleElement(targetElems[i]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tKekule.X.domReady(KekuleQuizReportInterceptor.execute);\r\n\t}\r\n\r\n\treturn {\r\n\t\t'init': function(){\r\n\t\t\t//console.log('Kekule', Kekule);\r\n\t\t\tKekule._ready(init);\r\n\t\t}\r\n\t}\r\n});"],"file":"kekuleChemViewerInterceptor.min.js"}